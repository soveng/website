---
import Base from "@/layouts/Base.astro";
import ContentLead from "@/layouts/components/ContentLead.astro";
import ContentSection from "@/layouts/components/ContentSection.astro";
import schoolOfAthensSketchImage from "@/assets/images/school-of-athens-sketch.jpg";
import philosophyQuotes from "@/data/philosophy-quotes.json";
import type { CollectionEntry } from "astro:content";
import { getEntry } from "astro:content";
import type { ImageMetadata } from "astro";

// Get policy content
const policy = (await getEntry(
  "policy",
  "-index"
)) as CollectionEntry<"policy">;

const { title, meta_title, description, intro, sections } = policy.data;

// Helper function to find quote by ID
const getQuoteById = (id: string) => {
  return philosophyQuotes.find(q => q.id === id);
};

// Get the policy sovereignty quote for the ContentLead
const leadQuote = getQuoteById("policy-sovereignty");

// Map image filenames to imported slide objects
const slideMap: Record<string, ImageMetadata | string> = {
  "school-of-athens-sketch.jpg": schoolOfAthensSketchImage,
};

interface Section {
  id: string;
  title: string;
  content: string;
  image?: string;
  float?: string;
  afterContent?: string;
}
---

<Base
  title={title}
  meta_title={meta_title}
  description={description}
>
  <!-- Intro Lead Section -->
  <ContentLead
    title={title}
    content={intro.content}
    image={intro.image ? slideMap[intro.image] : ""}
    quote={leadQuote?.quote || ""}
    author={leadQuote?.author || ""}
  />

  <!-- Policy Sections -->
  {sections && sections.length > 0 && sections.map(
    (section: Section, index: number) => (
    <ContentSection
      title={section.title}
      content={section.content}
      image={section.image ? slideMap[section.image] : ""}
      index={index}
      id={section.id}
      afterContent={section.afterContent}
    />
  ))}
</Base>
